import{_ as n,c as p,o as t,a4 as e}from"./chunks/framework.-JfgED0h.js";const l="/docs/assets/image-20221216160009145.C0pcEzw1.png",i="/docs/assets/image-20221216162622582.v2OtwOaM.png",o="/docs/assets/image-20221216170946166.BVikzRdb.png",c="/docs/assets/image-20221216200653717.ByWT4ctU.png",r="/docs/assets/image-20221216203904713.XFlXpCC4.png",d="/docs/assets/image-20221216210054136.CGmynJCX.png",u="/docs/assets/image-20221216210643628.CKvlGA_c.png",g="/docs/assets/image-20221216210938612.L2KLnOn7.png",m="/docs/assets/image-20221216211629307.BqgCOOfK.png",h="/docs/assets/image-20221216212152607.tOzIEtY0.png",b="/docs/assets/image-20221216215320623.BK8VSZ29.png",q="/docs/assets/image-20221216215041710.AGvrVXhW.png",v="/docs/assets/image-20221216215930807.D8KNyTCN.png",S="/docs/assets/image-20221216222533720.o3XjDE4h.png",y="/docs/assets/image-20221216222412510.Cl_fcgRD.png",C="/docs/assets/image-20221216222802617.DEB43bao.png",k="/docs/assets/image-20221216223328710.OJ6_YV1K.png",_="/docs/assets/image-20221216223300846.C3XiZzwi.png",f="/docs/assets/image-20221227211742547.28Is191-.png",I="/docs/assets/image-20221227214219279.BuRc4mYl.png",O="/docs/assets/image-20221227214753358.C4GaV30c.png",w="/docs/assets/image-20221227223851924.Da0U2VsO.png",B="/docs/assets/image-20220904200320964.DEDY6TL4.png",x="/docs/assets/image-20221229093412464.Cp9_hlvG.png",P="/docs/assets/image-20220904200642064.CeAWdJtX.png",D="/docs/assets/image-20221229095709505.CTXtxk3A.png",j="/docs/assets/image-20221229093911113.XP8Xbdy0.png",E="/docs/assets/image-20221229112451120.DpwVqkkV.png",T="/docs/assets/image-20220904201839857.CqWITkPh.png",A="/docs/assets/image-20220904201932884.CFu9UJiI.png",M="/docs/assets/image-20220904202537579.BcWRNiwf.png",R="/docs/assets/image-20220904202618423.D3SWU5Yh.png",F="/docs/assets/image-20220904201810832.C9hmZd4I.png",U="/docs/assets/image-20220904202235180.vHadRBOn.png",K="/docs/assets/image-20220904202824901.DGIE06Jp.png",N="/docs/assets/image-20221128020105943.B0kZx5hr.png",z="/docs/assets/image-20221229161326919.BmUZphuu.png",V="/docs/assets/image-20221229170235632.CbhGohGC.png",s="/docs/assets/image-20230102175353270.D6zvTPiL.png",X="/docs/assets/image-20220904220001994.whnzdrRS.png",a="/docs/assets/image-20220904220006578.BQCEiVo3.png",J="/docs/assets/image-20221230161841795.DPHiDtLZ.png",L="/docs/assets/image-20221230170926513.jJgQuaLR.png",W="/docs/assets/image-20221230171342318.Clple1sA.png",G="/docs/assets/image-20221231085558457.RwxwAoSF.png",H="/docs/assets/image-20230102173905913.maJ2ILiz.png",Y="/docs/assets/image-20230102181215809.3SPFMbfK.png",Z="/docs/assets/image-20230103084645450.DoOy292T.png",$="/docs/assets/image-20230103202630793.PvaP2c3t.png",Q="/docs/assets/image-20230103202919756.BgWqQla4.png",ss="/docs/assets/image-20230103210827003.Bz5IxczB.png",as="/docs/assets/image-20230103212042823.j3ErGOoB.png",ns="/docs/assets/image-20230113144757856.DybEFyad.png",ps="/docs/assets/image-20230113145158771.-W9St_dJ.png",ts="/docs/assets/image-20230113172313655.BWg0llcz.png",es="/docs/assets/image-20230113172854016.D7dMwU_j.png",ls="/docs/assets/image-20230113172659269.CVz6CPu8.png",is="/docs/assets/image-20230113173228232.CeWHFA97.png",os="/docs/assets/image-20230113162746634.C_Z-Diw4.png",cs="/docs/assets/image-20230113162639630.CTPl55Nf.png",rs="/docs/assets/image-20230113165006550.Co_7tktB.png",ds="/docs/assets/image-20230113170841253.XuFhEiVL.png",us="/docs/assets/image-20230113211619818.DC8s6sos.png",gs="/docs/assets/image-20230113214244144.DLuMyzcD.png",ms="/docs/assets/image-20230114001348839.Btl_q-wh.png",hs="/docs/assets/image-20230114001736151.BGRyMjDL.png",bs="/docs/assets/image-20230114003903285.CF4pPXuX.png",Bs=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"backend/spring-boot/SpringBootWeb案例.md","filePath":"backend/spring-boot/SpringBootWeb案例.md"}'),qs={name:"backend/spring-boot/SpringBootWeb案例.md"},vs=e('<h2 id="springbootweb案例" tabindex="-1">SpringBootWeb案例 <a class="header-anchor" href="#springbootweb案例" aria-label="Permalink to &quot;SpringBootWeb案例&quot;">​</a></h2><p>今日目标</p><ul><li>员工管理 <ul><li>新增员工 ✏️ <ul><li>文件上传(本地上传和oss上传) ✏️</li></ul></li><li>修改员工 ✏️</li></ul></li><li>其他 <ul><li>配置文件 <ul><li>yml格式 ✏️</li><li>@ConfigurationProperties 🍐✏️</li></ul></li></ul></li></ul><p>知识准备</p><ol><li>能理解controller，service，mapper三个包的含义以及调用顺序</li><li>能完成新增，修改，删除，查询基本操作</li><li>能理解前后端交互是用过JSON格式传递数据的</li><li>能说出HTTP协议的特点，特别是请求和响应的组成部分</li></ol><p><a href="http://www.yangeit.cn:21010/javaweb2023/day11_api.html" target="_blank" rel="noreferrer">api文档</a></p><p><img src="'+l+'" alt="image-20221216160009145"></p><h2 id="_1-新增员工-🚩" tabindex="-1">1. 新增员工 🚩 <a class="header-anchor" href="#_1-新增员工-🚩" aria-label="Permalink to &quot;1\\. 新增员工 🚩&quot;">​</a></h2><p>新增员工</p><p><img src="'+i+'" alt="image-20221216162622582"></p><p>在新增用户时，我们需要保存用户的基本信息，并且还需要上传的员工的图片，目前我们先完成第一步操作，保存用户的基本信息。</p><p><strong>新增员工的具体的流程：</strong></p><p><img src="'+o+`" alt="image-20221216170946166"></p><blockquote><p>接口文档规定 👇 👇：</p><ul><li>请求路径：/emps</li><li>请求方式：POST</li><li>请求参数：Json格式数据</li><li>响应数据：Json格式数据</li></ul></blockquote><p><strong>需求和接口文档</strong> 🎯</p><p>新增员工接口需求和接口文档</p><ul><li>基本信息</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>请求路径：/emps</span></span>
<span class="line"><span>请求方式：POST</span></span>
<span class="line"><span>接口描述：该接口用于添加员工的信息</span></span></code></pre></div><ul><li><p>请求参数 参数格式：application/json 参数说明：</p><table><thead><tr><th>名称</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>username</td><td>string</td><td>必须</td><td>用户名</td></tr><tr><td>name</td><td>string</td><td>必须</td><td>姓名</td></tr><tr><td>gender</td><td>number</td><td>必须</td><td>性别, 说明: 1 男, 2 女</td></tr><tr><td>image</td><td>string</td><td>非必须</td><td>图像</td></tr><tr><td>deptId</td><td>number</td><td>非必须</td><td>部门id</td></tr><tr><td>entrydate</td><td>string</td><td>非必须</td><td>入职日期</td></tr><tr><td>job</td><td>number</td><td>非必须</td><td>职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</td></tr></tbody></table><p>请求数据样例：</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;image&quot;: &quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg&quot;,</span></span>
<span class="line"><span>  &quot;username&quot;: &quot;linpingzhi&quot;,</span></span>
<span class="line"><span>  &quot;name&quot;: &quot;林平之&quot;,</span></span>
<span class="line"><span>  &quot;gender&quot;: 1,</span></span>
<span class="line"><span>  &quot;job&quot;: 1,</span></span>
<span class="line"><span>  &quot;entrydate&quot;: &quot;2022-09-18&quot;,</span></span>
<span class="line"><span>  &quot;deptId&quot;: 1</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li><p>响应数据 参数格式：application/json 参数说明：</p><table><thead><tr><th>参数名</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>code</td><td>number</td><td>必须</td><td>响应码，1 代表成功，0 代表失败</td></tr><tr><td>msg</td><td>string</td><td>非必须</td><td>提示信息</td></tr><tr><td>data</td><td>object</td><td>非必须</td><td>返回的数据</td></tr></tbody></table><p>响应数据样例：</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;code&quot;:1,</span></span>
<span class="line"><span>    &quot;msg&quot;:&quot;success&quot;,</span></span>
<span class="line"><span>    &quot;data&quot;:null</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>功能开发</strong> 👇 👇</p><p><strong>EmpController</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>@RequestMapping(&quot;/emps&quot;)</span></span>
<span class="line"><span>public class EmpController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpService empService;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //新增</span></span>
<span class="line"><span>    @PostMapping</span></span>
<span class="line"><span>    public Result save(@RequestBody Emp emp){</span></span>
<span class="line"><span>        //记录日志</span></span>
<span class="line"><span>        log.info(&quot;新增员工, emp:{}&quot;,emp);</span></span>
<span class="line"><span>        //调用业务层新增功能</span></span>
<span class="line"><span>        empService.save(emp);</span></span>
<span class="line"><span>        //响应</span></span>
<span class="line"><span>        return Result.success();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>EmpService</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>public interface EmpService {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 保存员工信息</span></span>
<span class="line"><span>     * @param emp</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    void save(Emp emp);</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>EmpServiceImpl</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Service</span></span>
<span class="line"><span>public class EmpServiceImpl implements EmpService {</span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpMapper empMapper;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public void save(Emp emp) {</span></span>
<span class="line"><span>        //补全数据</span></span>
<span class="line"><span>        emp.setCreateTime(LocalDateTime.now());</span></span>
<span class="line"><span>        emp.setUpdateTime(LocalDateTime.now());</span></span>
<span class="line"><span>        //调用添加方法</span></span>
<span class="line"><span>        empMapper.insert(emp);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>EmpMapper</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Mapper</span></span>
<span class="line"><span>public interface EmpMapper {</span></span>
<span class="line"><span>    //新增员工</span></span>
<span class="line"><span>    @Insert(&quot;insert into emp (username, name, gender, image, job, entrydate, dept_id, create_time, update_time) &quot; +</span></span>
<span class="line"><span>            &quot;values (#{username}, #{name}, #{gender}, #{image}, #{job}, #{entrydate}, #{deptId}, #{createTime}, #{updateTime});&quot;)</span></span>
<span class="line"><span>    void insert(Emp emp);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>课堂作业</p><ol><li>🚩 独自完成新增员工的逻辑，并进行PostMan测试，最后在进行前后联调</li></ol><h2 id="_2-文件上传-🚩-✏️-🍐" tabindex="-1">2. 文件上传 🚩 ✏️ 🍐 <a class="header-anchor" href="#_2-文件上传-🚩-✏️-🍐" aria-label="Permalink to &quot;2\\. 文件上传 🚩 ✏️ 🍐&quot;">​</a></h2><p>问题</p><ol><li>新增员工功能中，还存在一个问题：没有头像(图片缺失)，怎么解决？</li></ol><p><img src="`+c+'" alt="image-20221216200653717"></p><p>点击查看解决方案</p><ol><li>使用文件上传，将图片存储到本地或者阿里云服务器中</li></ol><h3 id="_1️⃣-2-1-简介-pear" tabindex="-1">1️⃣ 2.1 简介 :pear <a class="header-anchor" href="#_1️⃣-2-1-简介-pear" aria-label="Permalink to &quot;1️⃣ 2.1 简介 :pear&quot;">​</a></h3><p><strong>文件上传</strong>，是指将本地图片、视频、音频等文件上传到服务器，<strong>供其他用户浏览或下载</strong>的过程。</p><p>文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</p><p><img src="'+r+`" alt="image-20221216203904713"></p><blockquote><p>在我们的案例中，在新增员工的时候，要上传员工的头像，此时就会涉及到文件上传的功能。在进行文件上传时，我们点击加号或者是点击图片，就可以选择手机或者是电脑本地的图片文件了。当我们选择了某一个图片文件之后，这个文件就会上传到服务器，从而完成文件上传的操作。</p></blockquote><p>想要完成文件上传这个功能需要涉及到两个部分：</p><ol><li>前端程序</li><li>服务端程序</li></ol><p><strong>我们先来看看在前端程序中要完成哪些代码：</strong> 前端代码规则，了解一下</p><p>点击查看前端代码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span>
<span class="line"><span>姓名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>    年龄: &lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>    头像: &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span></span>
<span class="line"><span>&lt;/form&gt;</span></span></code></pre></div><p>上传文件的原始form表单，要求表单必须具备以下三点（上传文件页面三要素）：</p><ul><li><h5 id="_1️⃣-表单必须有file域-用于选择要上传的文件" tabindex="-1">1️⃣ 表单必须有file域，用于选择要上传的文件 <a class="header-anchor" href="#_1️⃣-表单必须有file域-用于选择要上传的文件" aria-label="Permalink to &quot;1️⃣ 表单必须有file域，用于选择要上传的文件&quot;">​</a></h5><blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;input type=&quot;file&quot; name=&quot;image&quot;/&gt;</span></span></code></pre></div></blockquote></li><li><h5 id="_2️⃣-表单提交方式必须为post" tabindex="-1">2️⃣ 表单提交方式必须为POST <a class="header-anchor" href="#_2️⃣-表单提交方式必须为post" aria-label="Permalink to &quot;2️⃣ 表单提交方式必须为POST&quot;">​</a></h5><blockquote><p>通常上传的文件会比较大，所以需要使用 POST 提交方式</p></blockquote></li><li><h5 id="_3️⃣-表单的编码类型enctype必须要设置为-multipart-form-data" tabindex="-1">3️⃣ 表单的编码类型enctype必须要设置为：multipart/form-data <a class="header-anchor" href="#_3️⃣-表单的编码类型enctype必须要设置为-multipart-form-data" aria-label="Permalink to &quot;3️⃣ 表单的编码类型enctype必须要设置为：multipart/form-data&quot;">​</a></h5><blockquote><p>普通默认的编码格式是不适合传输大型的二进制数据的，所以在文件上传时，表单的编码格式必须设置为multipart/form-data</p></blockquote></li></ul><p>前端页面的3要素我们了解后，接下来我们就来验证下所讲解的文件上传3要素。</p><p>资料提供</p><p>在提供的&quot;课程资料&quot;中有一个名叫&quot;文件上传&quot;的文件夹，直接将里的&quot;upload.html&quot;文件，复制到springboot项目工程下的static目录里面。</p><p><img src="`+d+`" alt="image-20221216210054136"></p><p>点击查看upload.html代码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span>&lt;html lang=&quot;en&quot;&gt;</span></span>
<span class="line"><span>&lt;head&gt;</span></span>
<span class="line"><span>    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span class="line"><span>    &lt;title&gt;上传文件&lt;/title&gt;</span></span>
<span class="line"><span>&lt;/head&gt;</span></span>
<span class="line"><span>&lt;body&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span>
<span class="line"><span>        姓名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        年龄: &lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        头像: &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span></span>
<span class="line"><span>    &lt;/form&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/body&gt;</span></span>
<span class="line"><span>&lt;/html&gt;</span></span></code></pre></div><p><strong>下面我们来验证：删除form表单中enctype属性值，会是什么情况？</strong></p><ol><li>在IDEA中直接使用浏览器打开upload.html页面</li></ol><p><img src="`+u+'" alt="image-20221216210643628"></p><ol start="2"><li>选择要上传的本地文件</li></ol><p><img src="'+g+'" alt="image-20221216210938612"></p><ol start="3"><li>点击&quot;提交&quot;按钮，进入到开发者模式观察</li></ol><p><img src="'+m+'" alt="image-20221216211629307"></p><p><img src="'+h+`" alt="image-20221216212152607"></p><p><strong>我们再来验证：设置form表单中enctype属性值为multipart/form-data，会是什么情况？</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span> &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span>
<span class="line"><span>        姓名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        年龄: &lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        头像: &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;&lt;br&gt;</span></span>
<span class="line"><span>        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span></span>
<span class="line"><span>    &lt;/form&gt;</span></span></code></pre></div><p><img src="`+b+'" alt="image-20221216215320623"></p><p><img src="'+q+'" alt="image-20221216215041710"></p><p>后端程序接受前端上传文件步鄹 后端代码规则，学习一下</p><ul><li><p>首先在服务端定义这么一个controller，用来进行文件上传，然后在controller当中定义一个方法来处理<code>/upload</code> 请求</p></li><li><p>在定义的方法中接收提交过来的数据 （方法中的形参名和请求参数的名字保持一致）</p><ul><li>用户名：String name</li><li>年龄： Integer age</li><li>文件： MultipartFile image</li></ul><blockquote><p>Spring中提供了一个API：MultipartFile，使用这个API就可以来接收到上传的文件</p></blockquote></li></ul><p><img src="'+v+`" alt="image-20221216215930807"></p><p>如果表单项的名字和方法中形参名不一致，该怎么办？后端小技巧，了解一下</p><p>点击查看解决方案</p><p>upload.html</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>public Result upload(String username,</span></span>
<span class="line"><span>                    Integer age, </span></span>
<span class="line"><span>                    MultipartFile file) //file形参名和请求参数名image不一致</span></span></code></pre></div><p>解决：使用@RequestParam注解进行参数绑定</p><p><strong>UploadController代码：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>public class UploadController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @PostMapping(&quot;/upload&quot;)</span></span>
<span class="line"><span>    public Result upload(String username, Integer age, MultipartFile image)  {</span></span>
<span class="line"><span>        log.info(&quot;文件上传：{},{},{}&quot;,username,age,image);</span></span>
<span class="line"><span>        return Result.success();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><blockquote><p>后端程序编写完成之后，打个断点，以debug方式启动SpringBoot项目</p></blockquote><p><img src="`+S+'" alt="image-20221216222533720"></p><blockquote><p>打开浏览器输入：<a href="http://localhost:8080/upload.html" target="_blank" rel="noreferrer">http://localhost:8080/upload.htmlopen in new window</a> ， 录入数据并提交</p></blockquote><p><img src="'+y+'" alt="image-20221216222412510"></p><p>通过后端程序控制台可以看到，上传的文件是存放在一个临时目录</p><p><img src="'+C+'" alt="image-20221216222802617"></p><blockquote><p>打开临时目录可以看到以下内容：</p></blockquote><p><img src="'+k+'" alt="image-20221216223328710"></p><blockquote><p>表单提交的三项数据(姓名、年龄、文件)，分别存储在不同的临时文件中：</p></blockquote><p><img src="'+_+`" alt="image-20221216223300846"></p><blockquote><p>当我们程序运行完毕之后，这个临时文件会自动删除。</p><p>所以，我们如果想要实现文件上传，需要将这个临时文件，要转存到我们的磁盘目录中。</p></blockquote><h3 id="_2️⃣2-2-本地存储" tabindex="-1">2️⃣2.2 本地存储 <a class="header-anchor" href="#_2️⃣2-2-本地存储" aria-label="Permalink to &quot;2️⃣2.2 本地存储&quot;">​</a></h3><p>前面我们已分析了文件上传功能前端和后端的基础代码实现，<strong>文件上传时在服务端会产生一个临时文件</strong>，请求响应完成之后，这个临时文件<strong>被自动删除</strong>，并没有进行保存。下面呢，<strong>我们就需要完成将上传的文件保存在服务器的本地磁盘上</strong>持久化。</p><p>代码实现：</p><ol><li>在服务器本地磁盘上创建images目录，用来存储上传的文件（例：E盘创建images目录）</li><li>使用MultipartFile类提供的API方法，把临时文件转存到本地磁盘目录下</li></ol><blockquote><p>MultipartFile 常见方法：</p><ul><li>String getOriginalFilename(); //获取原始文件名</li><li>void transferTo(File dest); //将接收的文件转存到磁盘文件中</li><li>long getSize(); //获取文件的大小，单位：字节</li><li>byte[] getBytes(); //获取文件内容的字节数组</li><li>InputStream getInputStream(); //获取接收到的文件内容的输入流</li></ul></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>public class UploadController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @PostMapping(&quot;/upload&quot;)</span></span>
<span class="line"><span>    public Result upload(String username, Integer age, MultipartFile image) throws IOException {</span></span>
<span class="line"><span>        log.info(&quot;文件上传：{},{},{}&quot;,username,age,image);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //获取原始文件名</span></span>
<span class="line"><span>        String originalFilename = image.getOriginalFilename();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //将文件存储在服务器的磁盘目录</span></span>
<span class="line"><span>        image.transferTo(new File(&quot;E:/images/&quot;+originalFilename));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        return Result.success();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><p>点击查看测试步鄹 和优化措施</p><p>利用postman测试：</p><blockquote><p>注意：请求参数名和controller方法形参名保持一致</p></blockquote><p><img src="`+f+'" alt="image-20221227211742547"></p><p><img src="'+I+'" alt="image-20221227214219279"></p><p><img src="'+O+`" alt="image-20221227214753358"></p><p>通过postman测试，我们发现文件上传是没有问题的。但是由于我们是使用原始文件名作为所上传文件的存储名字，当我们再次上传一个名为1.jpg文件时，<strong>发现会把之前已经上传成功的文件覆盖掉</strong>。 👇 👇 👇</p><p>点击查看文件覆盖掉的解决方案</p><p>解决方案：保证每次上传文件时文件名都唯一的（使用UUID获取随机文件名）</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>public class UploadController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @PostMapping(&quot;/upload&quot;)</span></span>
<span class="line"><span>    public Result upload(String username, Integer age, MultipartFile image) throws IOException {</span></span>
<span class="line"><span>        log.info(&quot;文件上传：{},{},{}&quot;,username,age,image);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //获取原始文件名</span></span>
<span class="line"><span>        String originalFilename = image.getOriginalFilename();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //构建新的文件名</span></span>
<span class="line"><span>        String extname = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));//文件扩展名</span></span>
<span class="line"><span>        String newFileName = UUID.randomUUID().toString()+extname;//随机名+文件扩展名</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //将文件存储在服务器的磁盘目录</span></span>
<span class="line"><span>        image.transferTo(new File(&quot;E:/images/&quot;+newFileName));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        return Result.success();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><p>在解决了文件名唯一性的问题后，我们再次上传一个较大的文件(超出1M)时发现，后端程序报错：</p><p><img src="`+w+`" alt="image-20221227223851924"></p><p>报错原因呢是因为：在SpringBoot中，文件上传时默认单个文件最大大小为1M</p><p>那么如果需要上传大文件，可以在application.properties进行如下配置：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>#配置单个文件最大上传大小</span></span>
<span class="line"><span>spring.servlet.multipart.max-file-size=10MB</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#配置单个请求最大上传大小(一次请求可以上传多个文件)</span></span>
<span class="line"><span>spring.servlet.multipart.max-request-size=100MB</span></span></code></pre></div><p>到时此，我们文件上传的本地存储方式已完成了。</p><p>本地存储方式的不足</p><p><img src="`+B+'" alt="image-20220904200320964"></p><p>如果直接存储在服务器的磁盘目录中，存在以下缺点：</p><ul><li>不安全：磁盘如果损坏，所有的文件就会丢失</li><li>容量有限：如果存储大量的图片，磁盘空间有限(磁盘不可能无限制扩容)</li><li>无法直接访问</li></ul><p>通常有两种解决方案：</p><ul><li>自己搭建存储服务器，如：fastDFS 、MinIO 实用</li><li>使用现成的云服务，如：阿里云，腾讯云，华为云</li></ul><p>作业</p><ol><li>🚩 能够流畅的说出文件上传的注意事项以及核心Java类，以及本地存储的缺点</li></ol><h3 id="_3️⃣2-3-阿里云oss" tabindex="-1">3️⃣2.3 阿里云OSS <a class="header-anchor" href="#_3️⃣2-3-阿里云oss" aria-label="Permalink to &quot;3️⃣2.3 阿里云OSS&quot;">​</a></h3><h4 id="_2-3-1-准备" tabindex="-1">2.3.1 准备 <a class="header-anchor" href="#_2-3-1-准备" aria-label="Permalink to &quot;2.3.1 准备&quot;">​</a></h4><p><strong>阿里云是阿里巴巴集团旗下全球领先的云计算公司，也是国内最大的云服务提供商 。</strong></p><p><img src="'+x+'" alt="image-20221229093412464"></p><blockquote><p>云服务指的就是通过互联网对外提供的各种各样的服务，比如像：语音服务、短信服务、邮件服务、视频直播服务、文字识别服务、对象存储服务等等。</p><p>当我们在项目开发时需要用到某个或某些服务，就不需要自己来开发了，可以直接使用阿里云提供好的这些现成服务就可以了。比如：在项目开发当中，我们要实现一个短信发送的功能，如果我们项目组自己实现，将会非常繁琐，因为你需要和各个运营商进行对接。而此时阿里云完成了和三大运营商对接，并对外提供了一个短信服务。我们项目组只需要调用阿里云提供的短信服务，就可以很方便的来发送短信了。这样就降低了我们项目的开发难度，同时也提高了项目的开发效率。（大白话：别人帮我们实现好了功能，我们只要调用即可）</p><p>云服务提供商给我们提供的软件服务通常是需要收取一部分费用的。</p></blockquote><p>点击查看阿里云对象存储OSS介绍和使用</p><p>阿里云对象存储OSS（Object Storage Service），是一款海量、安全、低成本、高可靠的云存储服务。使用OSS，您可以通过网络随时存储和调用包括文本、图片、音频和视频等在内的各种文件。</p><p><img src="'+P+'" alt="image-20220904200642064"></p><p>在我们使用了阿里云OSS对象存储服务之后，我们的项目当中如果涉及到文件上传这样的业务，在前端进行文件上传并请求到服务端时，在服务器本地磁盘当中就不需要再来存储文件了。我们直接将接收到的文件上传到oss，由 oss帮我们存储和管理，同时阿里云的oss存储服务还保障了我们所存储内容的安全可靠。</p><p><img src="'+D+'" alt="image-20221229095709505"></p><p>那我们学习使用这类云服务，我们主要学习什么呢？其实我们主要学习的是如何在项目当中来使用云服务完成具体的业务功能。而无论使用什么样的云服务，阿里云也好，腾讯云、华为云也罢，在使用第三方的服务时，操作的思路都是一样的。</p><p><img src="'+j+'" alt="image-20221229093911113"></p><blockquote><p>SDK：Software Development Kit 的缩写，软件开发工具包，包括辅助软件开发的依赖（jar包）、代码示例等，都可以叫做SDK。</p><p>简单说，sdk中包含了我们使用第三方云服务时所需要的依赖，以及一些示例代码。我们可以参照sdk所提供的示例代码就可以完成入门程序。</p></blockquote><p>第三方服务使用的通用思路，我们做一个简单介绍之后，接下来我们就来介绍一下我们当前要使用的阿里云oss对象存储服务具体的使用步骤。</p><p><img src="'+E+'" alt="image-20221229112451120"></p><blockquote><p>Bucket：存储空间是用户用于存储对象（Object，就是文件）的容器，所有的对象都必须隶属于某个存储空间。</p></blockquote><p>下面我们根据之前介绍的使用步骤，完成准备工作：</p><ol><li>注册阿里云账户（注册完成后需要实名认证）</li><li>注册完账号之后，就可以登录阿里云</li></ol><p><img src="'+T+'" alt="image-20220904201839857"></p><ol start="3"><li>通过控制台找到对象存储OSS服务</li></ol><p><img src="'+A+'" alt="image-20220904201932884"></p><blockquote><p>如果是第一次访问，还需要开通对象存储服务OSS</p></blockquote><p><img src="'+M+'" alt="image-20220904202537579"></p><p><img src="'+R+'" alt="image-20220904202618423"></p><ol start="4"><li>开通OSS服务之后，就可以进入到阿里云对象存储的控制台</li></ol><p><img src="'+F+'" alt="image-20220904201810832"></p><ol start="5"><li>点击左侧的 &quot;Bucket列表&quot;，创建一个Bucket</li></ol><p><img src="'+U+'" alt="image-20220904202235180"></p><p><img src="'+K+'" alt=""></p><blockquote><p>大家可以参照&quot;资料\\04. 阿里云oss&quot;中提供的文档，开通阿里云OSS服务。<a href="http://www.yangeit.cn:21010/javaweb2023/AliOSS.html" target="_blank" rel="noreferrer">点击查看阿里云文档</a></p></blockquote><h4 id="_2-3-2-入门和集成" tabindex="-1">2.3.2 入门和集成 <a class="header-anchor" href="#_2-3-2-入门和集成" aria-label="Permalink to &quot;2.3.2 入门和集成&quot;">​</a></h4><p><a href="http://www.yangeit.cn:21010/javaweb2023/AliOSS.html" target="_blank" rel="noreferrer">查看阿里云oss文档</a></p><p>技巧</p><p>代码中，需要替换的内容为：</p><ul><li>accessKeyId：阿里云账号AccessKey</li><li>accessKeySecret：阿里云账号AccessKey对应的秘钥</li><li>bucketName：Bucket名称</li><li>objectName：对象名称，在Bucket中存储的对象的名称</li><li>filePath：文件路径</li></ul><p>AccessKey ：</p><p><img src="'+N+'" alt="image-20221128020105943"></p><p>运行以上程序后，会把本地的文件上传到阿里云OSS服务器上：</p><p><img src="'+z+'" alt="image-20221229161326919"></p><p>阿里云oss对象存储服务的准备工作以及入门程序我们都已经完成了，接下来我们就需要在案例当中集成oss对象存储服务，来存储和管理案例中上传的图片。</p><p><img src="'+V+`" alt="image-20221229170235632"></p><blockquote><p>在新增员工的时候，上传员工的图像，而之所以需要上传员工的图像，是因为将来我们需要在系统页面当中访问并展示员工的图像。而要想完成这个操作，需要做两件事：</p><ol><li>需要上传员工的图像，并把图像保存起来（存储到阿里云OSS）</li><li>访问员工图像（通过图像在阿里云OSS的存储地址访问图像） <ul><li>OSS中的每一个文件都会分配一个访问的url，通过这个url就可以访问到存储在阿里云上的图片。所以需要把url返回给前端，这样前端就可以通过url获取到图像。</li></ul></li></ol></blockquote><p><strong>我们参照接口文档来开发文件上传功能：</strong> 👇 👇</p><ul><li><p>基本信息</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>请求路径：/upload</span></span>
<span class="line"><span>请求方式：POST</span></span>
<span class="line"><span>接口描述：上传图片接口</span></span></code></pre></div></li><li><p>请求参数</p><ul><li>参数格式：<strong>multipart/form-data</strong></li><li>参数说明：</li></ul><table><thead><tr><th>参数名称</th><th>参数类型</th><th>是否必须</th><th>示例</th><th>备注</th></tr></thead><tbody><tr><td>image</td><td>file</td><td>必须</td><td></td><td></td></tr></tbody></table></li><li><p>响应数据 参数格式：application/json 参数说明：</p><table><thead><tr><th>参数名</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>code</td><td>number</td><td>必须</td><td>响应码，1 代表成功，0 代表失败</td></tr><tr><td>msg</td><td>string</td><td>非必须</td><td>提示信息</td></tr><tr><td>data</td><td>object</td><td>非必须</td><td>返回的数据，上传图片的访问路径</td></tr></tbody></table><p>响应数据样例：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;code&quot;: 1,</span></span>
<span class="line"><span>    &quot;msg&quot;: &quot;success&quot;,</span></span>
<span class="line"><span>    &quot;data&quot;: &quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-0400.jpg&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div></li></ul><p><strong>引入阿里云OSS上传文件工具类（由官方的示例代码改造而来）</strong> 👇 👇</p><p>点击查看阿里云OSS上传文件工具类代码</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>import com.aliyun.oss.OSS;</span></span>
<span class="line"><span>import com.aliyun.oss.OSSClientBuilder;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span>import org.springframework.web.multipart.MultipartFile;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.io.IOException;</span></span>
<span class="line"><span>import java.io.InputStream;</span></span>
<span class="line"><span>import java.util.UUID;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class AliOSSUtils {</span></span>
<span class="line"><span>    private String endpoint = &quot;https://oss-cn-shanghai.aliyuncs.com&quot;;</span></span>
<span class="line"><span>    private String accessKeyId = &quot;LTAI5t9MZK8iq5T2Av5GLDxX&quot;;</span></span>
<span class="line"><span>    private String accessKeySecret = &quot;C0IrHzKZGKqU8S7YQcevcotD3Zd5Tc&quot;;</span></span>
<span class="line"><span>    private String bucketName = &quot;web-framework01&quot;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 实现上传图片到OSS</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    public String upload(MultipartFile multipartFile) throws IOException {</span></span>
<span class="line"><span>        // 获取上传的文件的输入流</span></span>
<span class="line"><span>        InputStream inputStream = multipartFile.getInputStream();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // 避免文件覆盖</span></span>
<span class="line"><span>        String originalFilename = multipartFile.getOriginalFilename();</span></span>
<span class="line"><span>        String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //上传文件到 OSS</span></span>
<span class="line"><span>        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span></span>
<span class="line"><span>        ossClient.putObject(bucketName, fileName, inputStream);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //文件访问路径</span></span>
<span class="line"><span>        String url = endpoint.split(&quot;//&quot;)[0] + &quot;//&quot; + bucketName + &quot;.&quot; + endpoint.split(&quot;//&quot;)[1] + &quot;/&quot; + fileName;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // 关闭ossClient</span></span>
<span class="line"><span>        ossClient.shutdown();</span></span>
<span class="line"><span>        return url;// 把上传到oss的路径返回</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>修改UploadController代码：</strong> 👈 👈</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>public class UploadController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private AliOSSUtils aliOSSUtils;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @PostMapping(&quot;/upload&quot;)</span></span>
<span class="line"><span>    public Result upload(MultipartFile image) throws IOException {</span></span>
<span class="line"><span>        //调用阿里云OSS工具类，将上传上来的文件存入阿里云</span></span>
<span class="line"><span>        String url = aliOSSUtils.upload(image);</span></span>
<span class="line"><span>        //将图片上传完成后的url返回，用于浏览器回显展示</span></span>
<span class="line"><span>        return Result.success(url);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>}</span></span></code></pre></div><p>使用postman测试：</p><p><img src="`+s+'" alt="image-20230102175353270"></p><p>作业</p><ol><li>🚩 注册阿里云账号，开通Oss服务，完成上述服务，并且能够使用清晰的描述出集成oss流程。（可以使用流程图工具进行绘制）</li></ol><h2 id="_3-修改员工-🚩" tabindex="-1">3. 修改员工 🚩 <a class="header-anchor" href="#_3-修改员工-🚩" aria-label="Permalink to &quot;3\\. 修改员工 🚩&quot;">​</a></h2><p>需求</p><ol><li>修改员工信息</li></ol><p><img src="'+X+'" alt="image-20220904220001994"></p><p><img src="'+a+'" alt="image-20220904220001994"></p><p>点击查看步骤</p><ol><li>根据ID查询员工信息</li><li>保存修改的员工信息</li></ol><h3 id="_1️⃣3-1-查询回显-✏️" tabindex="-1">1️⃣3.1 查询回显 ✏️ <a class="header-anchor" href="#_1️⃣3-1-查询回显-✏️" aria-label="Permalink to &quot;1️⃣3.1 查询回显 ✏️&quot;">​</a></h3><p>查询回显</p><h4 id="_3-1-2-实现思路" tabindex="-1">3.1.2 实现思路 <a class="header-anchor" href="#_3-1-2-实现思路" aria-label="Permalink to &quot;3.1.2 实现思路&quot;">​</a></h4><p><img src="'+J+`" alt="image-20221230161841795"></p><h4 id="_3-1-1-接口文档" tabindex="-1">3.1.1 接口文档 <a class="header-anchor" href="#_3-1-1-接口文档" aria-label="Permalink to &quot;3.1.1 接口文档&quot;">​</a></h4><p><a href="http://www.yangeit.cn:21010/javaweb2023/day11_api.html" target="_blank" rel="noreferrer">api文档</a> 👈 可点击查看接口文档</p><p>根据ID查询员工数据</p><ul><li><p>基本信息</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>请求路径：/emps/{id}</span></span>
<span class="line"><span>请求方式：GET</span></span>
<span class="line"><span>接口描述：该接口用于根据主键ID查询员工的信息</span></span></code></pre></div></li><li><p>请求参数</p><ul><li>参数格式：路径参数</li><li>参数说明：</li></ul><table><thead><tr><th>参数名</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>id</td><td>number</td><td>必须</td><td>员工ID</td></tr></tbody></table><ul><li>请求参数样例：</li></ul></li><li><p>响应数据 参数格式：application/json 参数说明：</p><table><thead><tr><th>名称</th><th>类型</th><th>是否必须</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td>code</td><td>number</td><td>必须</td><td></td><td>响应码, 1 成功 , 0 失败</td></tr><tr><td>msg</td><td>string</td><td>非必须</td><td></td><td>提示信息</td></tr><tr><td>data</td><td>object</td><td>必须</td><td></td><td>返回的数据</td></tr><tr><td></td><td>- id</td><td>number</td><td>非必须</td><td></td></tr><tr><td></td><td>- username</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- name</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- password</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- entrydate</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- gender</td><td>number</td><td>非必须</td><td></td></tr><tr><td></td><td>- image</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- job</td><td>number</td><td>非必须</td><td></td></tr><tr><td></td><td>- deptId</td><td>number</td><td>非必须</td><td></td></tr><tr><td></td><td>- createTime</td><td>string</td><td>非必须</td><td></td></tr><tr><td></td><td>- updateTime</td><td>string</td><td>非必须</td><td></td></tr></tbody></table><p>响应数据样例：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;code&quot;: 1,</span></span>
<span class="line"><span>  &quot;msg&quot;: &quot;success&quot;,</span></span>
<span class="line"><span>  &quot;data&quot;: {</span></span>
<span class="line"><span>    &quot;id&quot;: 2,</span></span>
<span class="line"><span>    &quot;username&quot;: &quot;zhangwuji&quot;,</span></span>
<span class="line"><span>    &quot;password&quot;: &quot;123456&quot;,</span></span>
<span class="line"><span>    &quot;name&quot;: &quot;张无忌&quot;,</span></span>
<span class="line"><span>    &quot;gender&quot;: 1,</span></span>
<span class="line"><span>    &quot;image&quot;: &quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg&quot;,</span></span>
<span class="line"><span>    &quot;job&quot;: 2,</span></span>
<span class="line"><span>    &quot;entrydate&quot;: &quot;2015-01-01&quot;,</span></span>
<span class="line"><span>    &quot;deptId&quot;: 2,</span></span>
<span class="line"><span>    &quot;createTime&quot;: &quot;2022-09-01T23:06:30&quot;,</span></span>
<span class="line"><span>    &quot;updateTime&quot;: &quot;2022-09-02T00:29:04&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div></li></ul><h4 id="_3-1-3-代码实现" tabindex="-1">3.1.3 代码实现 <a class="header-anchor" href="#_3-1-3-代码实现" aria-label="Permalink to &quot;3.1.3 代码实现&quot;">​</a></h4><ul><li>EmpController</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>@RequestMapping(&quot;/emps&quot;)</span></span>
<span class="line"><span>public class EmpController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpService empService;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //根据id查询</span></span>
<span class="line"><span>    @GetMapping(&quot;/{id}&quot;)</span></span>
<span class="line"><span>    public Result getById(@PathVariable Integer id){</span></span>
<span class="line"><span>        Emp emp = empService.getById(id);</span></span>
<span class="line"><span>        return Result.success(emp);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpService</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>public interface EmpService {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 根据ID查询员工</span></span>
<span class="line"><span>     * @param id</span></span>
<span class="line"><span>     * @return</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    public Emp getById(Integer id);</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpServiceImpl</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Service</span></span>
<span class="line"><span>public class EmpServiceImpl implements EmpService {</span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpMapper empMapper;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public Emp getById(Integer id) {</span></span>
<span class="line"><span>        return empMapper.findById(id);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpMapper</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Mapper</span></span>
<span class="line"><span>public interface EmpMapper {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //根据ID查询员工信息</span></span>
<span class="line"><span>    @Select(&quot;select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time &quot; +</span></span>
<span class="line"><span>            &quot;from emp &quot; +</span></span>
<span class="line"><span>            &quot;where id = #{id}&quot;)</span></span>
<span class="line"><span>    public Emp findById(Integer id);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_3-1-4-postman测试" tabindex="-1">3.1.4 postman测试 <a class="header-anchor" href="#_3-1-4-postman测试" aria-label="Permalink to &quot;3.1.4 postman测试&quot;">​</a></h4><p><img src="`+L+'" alt="image-20221230170926513"></p><h3 id="_2️⃣-3-2-修改员工" tabindex="-1">2️⃣ 3.2 修改员工 <a class="header-anchor" href="#_2️⃣-3-2-修改员工" aria-label="Permalink to &quot;2️⃣ 3.2 修改员工&quot;">​</a></h3><p><a href="http://www.yangeit.cn:21010/javaweb2023/day11_api.html" target="_blank" rel="noreferrer">api文档</a> 👈 可点击查看接口文档</p><p>修改员工</p><p><img src="'+a+'" alt=""></p><blockquote><p>当用户修改完数据之后，点击保存按钮，就需要将数据提交到服务端，然后服务端需要将修改后的数据更新到数据库中。</p></blockquote><p><strong>思路：</strong></p><p><img src="'+W+`" alt="image-20221230171342318"></p><h4 id="_3-2-1-接口文档" tabindex="-1">3.2.1 接口文档 <a class="header-anchor" href="#_3-2-1-接口文档" aria-label="Permalink to &quot;3.2.1 接口文档&quot;">​</a></h4><p>修改员工</p><ul><li>基本信息</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>请求路径：/emps</span></span>
<span class="line"><span>请求方式：PUT</span></span>
<span class="line"><span>接口描述：该接口用于修改员工的数据信息</span></span></code></pre></div><ul><li><p>请求参数 参数格式：application/json 参数说明：</p><table><thead><tr><th>名称</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>id</td><td>number</td><td>必须</td><td>id</td></tr><tr><td>username</td><td>string</td><td>必须</td><td>用户名</td></tr><tr><td>name</td><td>string</td><td>必须</td><td>姓名</td></tr><tr><td>gender</td><td>number</td><td>必须</td><td>性别, 说明: 1 男, 2 女</td></tr><tr><td>image</td><td>string</td><td>非必须</td><td>图像</td></tr><tr><td>deptId</td><td>number</td><td>非必须</td><td>部门id</td></tr><tr><td>entrydate</td><td>string</td><td>非必须</td><td>入职日期</td></tr><tr><td>job</td><td>number</td><td>非必须</td><td>职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</td></tr></tbody></table><p>请求数据样例：</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;id&quot;: 1,</span></span>
<span class="line"><span>  &quot;image&quot;: &quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg&quot;,</span></span>
<span class="line"><span>  &quot;username&quot;: &quot;linpingzhi&quot;,</span></span>
<span class="line"><span>  &quot;name&quot;: &quot;林平之&quot;,</span></span>
<span class="line"><span>  &quot;gender&quot;: 1,</span></span>
<span class="line"><span>  &quot;job&quot;: 1,</span></span>
<span class="line"><span>  &quot;entrydate&quot;: &quot;2022-09-18&quot;,</span></span>
<span class="line"><span>  &quot;deptId&quot;: 1</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li><p>响应数据 参数格式：application/json 参数说明：</p><table><thead><tr><th>参数名</th><th>类型</th><th>是否必须</th><th>备注</th></tr></thead><tbody><tr><td>code</td><td>number</td><td>必须</td><td>响应码，1 代表成功，0 代表失败</td></tr><tr><td>msg</td><td>string</td><td>非必须</td><td>提示信息</td></tr><tr><td>data</td><td>object</td><td>非必须</td><td>返回的数据</td></tr></tbody></table><p>响应数据样例：</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;code&quot;:1,</span></span>
<span class="line"><span>    &quot;msg&quot;:&quot;success&quot;,</span></span>
<span class="line"><span>    &quot;data&quot;:null</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_3-2-3-代码实现" tabindex="-1">3.2.3 代码实现 <a class="header-anchor" href="#_3-2-3-代码实现" aria-label="Permalink to &quot;3.2.3 代码实现&quot;">​</a></h4><ul><li>EmpController</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>@RequestMapping(&quot;/emps&quot;)</span></span>
<span class="line"><span>public class EmpController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpService empService;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //修改员工</span></span>
<span class="line"><span>    @PutMapping</span></span>
<span class="line"><span>    public Result update(@RequestBody Emp emp){</span></span>
<span class="line"><span>        empService.update(emp);</span></span>
<span class="line"><span>        return Result.success();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpServiceImpl</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Service</span></span>
<span class="line"><span>public class EmpServiceImpl implements EmpService {</span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private EmpMapper empMapper;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public void update(Emp emp) {</span></span>
<span class="line"><span>        emp.setUpdateTime(LocalDateTime.now()); //更新修改时间为当前时间</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        empMapper.update(emp);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpService</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>public interface EmpService {</span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 更新员工</span></span>
<span class="line"><span>     * @param emp</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    public void update(Emp emp);</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpMapper</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Mapper</span></span>
<span class="line"><span>public interface EmpMapper {</span></span>
<span class="line"><span>    //修改员工信息</span></span>
<span class="line"><span>    public void update(Emp emp);</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    //省略...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>EmpMapper.xml</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span>
<span class="line"><span>&lt;!DOCTYPE mapper</span></span>
<span class="line"><span>        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="line"><span>        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span></span>
<span class="line"><span>&lt;mapper namespace=&quot;com.itheima.mapper.EmpMapper&quot;&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &lt;!--更新员工信息--&gt;</span></span>
<span class="line"><span>    &lt;update id=&quot;update&quot;&gt;</span></span>
<span class="line"><span>        update emp</span></span>
<span class="line"><span>        &lt;set&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;username != null and username != &#39;&#39;&quot;&gt;</span></span>
<span class="line"><span>                username = #{username},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;password != null and password != &#39;&#39;&quot;&gt;</span></span>
<span class="line"><span>                password = #{password},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;name != null and name != &#39;&#39;&quot;&gt;</span></span>
<span class="line"><span>                name = #{name},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;gender != null&quot;&gt;</span></span>
<span class="line"><span>                gender = #{gender},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;image != null and image != &#39;&#39;&quot;&gt;</span></span>
<span class="line"><span>                image = #{image},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;job != null&quot;&gt;</span></span>
<span class="line"><span>                job = #{job},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;entrydate != null&quot;&gt;</span></span>
<span class="line"><span>                entrydate = #{entrydate},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;deptId != null&quot;&gt;</span></span>
<span class="line"><span>                dept_id = #{deptId},</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>            &lt;if test=&quot;updateTime != null&quot;&gt;</span></span>
<span class="line"><span>                update_time = #{updateTime}</span></span>
<span class="line"><span>            &lt;/if&gt;</span></span>
<span class="line"><span>        &lt;/set&gt;</span></span>
<span class="line"><span>        where id = #{id}</span></span>
<span class="line"><span>    &lt;/update&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &lt;!-- 省略... --&gt;</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>&lt;/mapper&gt;</span></span></code></pre></div><h2 id="_4-配置文件-🍐" tabindex="-1">4. 配置文件 🍐 <a class="header-anchor" href="#_4-配置文件-🍐" aria-label="Permalink to &quot;4\\. 配置文件 🍐&quot;">​</a></h2><p>接下来，进行代码优化</p><h3 id="_1️⃣4-1-优化-参数配置化" tabindex="-1">1️⃣4.1 优化-参数配置化 <a class="header-anchor" href="#_1️⃣4-1-优化-参数配置化" aria-label="Permalink to &quot;1️⃣4.1 优化-参数配置化&quot;">​</a></h3><p>问题：密钥和身份ID直接在Java代码中</p><p><img src="`+G+`" alt="image-20221231085558457"></p><ul><li>endpoint //阿里云OSS域名</li><li>accessKeyID //用户身份ID</li><li>accessKeySecret //用户密钥</li><li>bucketName //存储空间的名字</li></ul><p>上述写法存在两个问题</p><ol><li>如果这些参数发生变化了，就必须在源程序代码中改动这些参数，然后需要<strong>重新进行代码的编译</strong>，将Java代码编译成class字节码文件再重新运行程序。（<strong>比较繁琐</strong>）</li><li>如果我们开发的是一个真实的企业级项目， <strong>Java类可能会有很多</strong>，如果将这些参数分散的定义在各个Java类当中，我们要修改一个参数值，我们就需要在众多的Java代码当中来定位到对应的位置，再来修改参数，修改完毕之后再重新编译再运行。（<em>参数配置过于分散，是不方便集中的管理和维护</em>）</li></ol><p>点击查看方案</p><h5 id="_1️⃣-可以将参数配置在配置文件" tabindex="-1">1️⃣ <strong>可以将参数配置在配置文件</strong> <a class="header-anchor" href="#_1️⃣-可以将参数配置在配置文件" aria-label="Permalink to &quot;1️⃣ **可以将参数配置在配置文件**&quot;">​</a></h5><p>application.properties文件</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>#自定义的阿里云OSS配置信息</span></span>
<span class="line"><span>aliyun.oss.endpoint=https://oss-cn-hangzhou.aliyuncs.com</span></span>
<span class="line"><span>aliyun.oss.accessKeyId=LTAI4GCH1vX6DKqJWxd6nEuW</span></span>
<span class="line"><span>aliyun.oss.accessKeySecret=yBshYweHOpqDuhCArrVHwIiBKpyqSL</span></span>
<span class="line"><span>aliyun.oss.bucketName=web-tlias</span></span></code></pre></div><h5 id="_2️⃣-再将阿里云oss配置参数交给properties配置文件来管理之后-我们的aliossutils工具类就变为以下形式" tabindex="-1">2️⃣ 再将阿里云OSS配置参数交给properties配置文件来管理之后，我们的AliOSSUtils工具类就变为以下形式： <a class="header-anchor" href="#_2️⃣-再将阿里云oss配置参数交给properties配置文件来管理之后-我们的aliossutils工具类就变为以下形式" aria-label="Permalink to &quot;2️⃣ 再将阿里云OSS配置参数交给properties配置文件来管理之后，我们的AliOSSUtils工具类就变为以下形式：&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Component</span></span>
<span class="line"><span>public class AliOSSUtils {</span></span>
<span class="line"><span>    /*以下4个参数没有指定值（默认值：null）*/</span></span>
<span class="line"><span>    private String endpoint;</span></span>
<span class="line"><span>    private String accessKeyId;</span></span>
<span class="line"><span>    private String accessKeySecret;</span></span>
<span class="line"><span>    private String bucketName;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略其他代码...</span></span>
<span class="line"><span>}</span></span></code></pre></div><blockquote><p>而此时如果直接调用AliOSSUtils类当中的upload方法进行文件上传时，这4项参数全部为null，原因是因为并没有给它赋值。</p><p>此时我们是不是需要将配置文件当中所配置的属性值读取出来，并分别赋值给AliOSSUtils工具类当中的各个属性呢？那应该怎么做呢？</p></blockquote><p>因为application.properties是springboot项目默认的配置文件，所以springboot程序在启动时会默认读取application.properties配置文件，而我们可以使用一个现成的注解：<code>@Value</code>，获取<strong>配置文件中的数据</strong>。</p><h5 id="_3️⃣-value-注解通常用于外部配置的属性注入-具体用法为-value-配置文件中的key" tabindex="-1">3️⃣ <code>@Value</code> 注解通常用于外部配置的属性注入，具体用法为： @Value(&quot;\${配置文件中的key}&quot;) <a class="header-anchor" href="#_3️⃣-value-注解通常用于外部配置的属性注入-具体用法为-value-配置文件中的key" aria-label="Permalink to &quot;3️⃣ \`@Value\` 注解通常用于外部配置的属性注入，具体用法为： @Value(&quot;\${配置文件中的key}&quot;)&quot;">​</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Component</span></span>
<span class="line"><span>public class AliOSSUtils {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Value(&quot;\${aliyun.oss.endpoint}&quot;)</span></span>
<span class="line"><span>    private String endpoint;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    @Value(&quot;\${aliyun.oss.accessKeyId}&quot;)</span></span>
<span class="line"><span>    private String accessKeyId;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    @Value(&quot;\${aliyun.oss.accessKeySecret}&quot;)</span></span>
<span class="line"><span>    private String accessKeySecret;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    @Value(&quot;\${aliyun.oss.bucketName}&quot;)</span></span>
<span class="line"><span>    private String bucketName;</span></span>
<span class="line"><span> </span></span>
<span class="line"><span> //省略其他代码...</span></span>
<span class="line"><span> }</span></span></code></pre></div><p><img src="`+H+'" alt="image-20230102173905913"></p><p>使用postman测试：</p><p><img src="'+s+'" alt="image-20230102175353270"></p><h3 id="_2️⃣4-2-优化-yml配置文件-🍐-❤️" tabindex="-1">2️⃣4.2 优化-yml配置文件 🍐 ❤️ <a class="header-anchor" href="#_2️⃣4-2-优化-yml配置文件-🍐-❤️" aria-label="Permalink to &quot;2️⃣4.2 优化-yml配置文件 🍐 ❤️&quot;">​</a></h3><p>常见配置文件格式</p><blockquote><p>前面我们一直使用springboot项目创建完毕后自带的application.properties进行属性的配置，那其实呢，在springboot项目当中是支持多种配置方式的，除了支持properties配置文件以外，还支持另外一种类型的配置文件，就是我们接下来要讲解的yml格式的配置文件。</p></blockquote><p><img src="'+Y+`" alt="image-20230102181215809"></p><p>点击查看常见配置文件格式</p><ul><li><p>application.properties</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>server.port=8080</span></span>
<span class="line"><span>server.address=127.0.0.1</span></span></code></pre></div></li><li><p>application.yml</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>server:</span></span>
<span class="line"><span>  port: 8080</span></span>
<span class="line"><span>  address: 127.0.0.1</span></span></code></pre></div></li><li><p>application.yaml</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>server:</span></span>
<span class="line"><span>  port: 8080</span></span>
<span class="line"><span>  address: 127.0.0.1</span></span></code></pre></div></li></ul><blockquote><p>yml 格式的配置文件，后缀名有两种：</p><ul><li>yml （推荐） 开发实用</li><li>yaml</li></ul></blockquote><p>yml格式的数据有以下特点：</p><ul><li>容易阅读</li><li>容易与脚本语言交互</li><li>以数据为核心，重数据轻格式</li></ul><p>yml配置文件的基本语法</p><ul><li>大小写敏感</li><li>数值前边必须有空格，作为分隔符</li><li>使用缩进表示层级关系，缩进时，不允许使用Tab键，只能用空格（idea中会自动将Tab转换为空格）</li><li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li><li><code>#</code>表示注释，从这个字符一直到行尾，都会被解析器忽略</li></ul><p><img src="`+Z+'" alt="image-20230103084645450"></p><p>properties改成yml格式 步骤</p><p>熟悉完了yml文件的基本语法后，我们修改下之前案例中使用的配置文件，变更为application.yml配置方式：</p><ol><li>修改application.properties名字为：<code>_application.properties</code>（名字随便更换，只要加载不到即可）</li><li>创建新的配置文件： <code>application.yml</code></li></ol><p><strong>原有application.properties文件：</strong></p><p><img src="'+$+`" alt="image-20230103202630793"></p><p><strong>新建的application.yml文件：</strong> 👍</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>  datasource:</span></span>
<span class="line"><span>    driver-class-name: com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span>    url: jdbc:mysql://localhost:3306/tlias</span></span>
<span class="line"><span>    username: root</span></span>
<span class="line"><span>    password: 1234</span></span>
<span class="line"><span>  servlet:</span></span>
<span class="line"><span>    multipart:</span></span>
<span class="line"><span>      max-file-size: 10MB</span></span>
<span class="line"><span>      max-request-size: 100MB</span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>mybatis:</span></span>
<span class="line"><span>  configuration:</span></span>
<span class="line"><span>    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span></span>
<span class="line"><span>    map-underscore-to-camel-case: true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>aliyun:</span></span>
<span class="line"><span>  oss:</span></span>
<span class="line"><span>    endpoint: https://oss-cn-hangzhou.aliyuncs.com</span></span>
<span class="line"><span>    accessKeyId: LTAI4GCH1vX6DKqJWxd6nEuW</span></span>
<span class="line"><span>    accessKeySecret: yBshYweHOpqDuhCArrVHwIiBKpyqSL</span></span>
<span class="line"><span>    bucketName: web-397</span></span></code></pre></div><h3 id="_3️⃣4-3-configurationproperties-🍐" tabindex="-1">3️⃣4.3 @ConfigurationProperties 🍐 <a class="header-anchor" href="#_3️⃣4-3-configurationproperties-🍐" aria-label="Permalink to &quot;3️⃣4.3 @ConfigurationProperties 🍐&quot;">​</a></h3><p>问题：单独使用@Value的不足之处</p><p><img src="`+Q+'" alt="image-20230103202919756"></p><p>我们在application.properties或者application.yml中配置了阿里云OSS的四项参数之后，如果java程序中需要这四项参数数据，我们直接通过@Value注解来进行注入。这种方式本身没有什么问题问题，<strong>但是如果说需要注入的属性较多(例：需要20多个参数数据)，我们写起来就会比较繁琐。</strong> ⚠️</p><p>Spring提供的简化方式：</p><ol><li><p>需要创建一个实现类，且实体类中的属性名和配置文件当中key的名字必须要一致</p><blockquote><p>比如：配置文件当中叫endpoints，实体类当中的属性也得叫endpoints，另外实体类当中的属性还需要提供 getter / setter方法</p></blockquote></li><li><p>需要将实体类交给Spring的IOC容器管理，成为IOC容器当中的bean对象</p></li><li><p>在实体类上添加<code>@ConfigurationProperties</code>注解，并通过perfect属性来指定配置参数项的前缀</p></li></ol><p><img src="'+ss+`" alt="image-20230103210827003"></p><p>1️⃣ 定义实体类AliOSSProperties</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>import lombok.Data;</span></span>
<span class="line"><span>import org.springframework.boot.context.properties.ConfigurationProperties;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/*阿里云OSS相关配置*/</span></span>
<span class="line"><span>@Data</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>@ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</span></span>
<span class="line"><span>public class AliOSSProperties {</span></span>
<span class="line"><span>    //区域</span></span>
<span class="line"><span>    private String endpoint;</span></span>
<span class="line"><span>    //身份ID</span></span>
<span class="line"><span>    private String accessKeyId ;</span></span>
<span class="line"><span>    //身份密钥</span></span>
<span class="line"><span>    private String accessKeySecret ;</span></span>
<span class="line"><span>    //存储空间</span></span>
<span class="line"><span>    private String bucketName;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>2️⃣ 修改AliOSSUtils工具类</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Component //当前类对象由Spring创建和管理</span></span>
<span class="line"><span>public class AliOSSUtils {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //注入配置参数实体类对象</span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private AliOSSProperties aliOSSProperties;</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * 实现上传图片到OSS</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    public String upload(MultipartFile multipartFile) throws IOException {</span></span>
<span class="line"><span>        // 获取上传的文件的输入流</span></span>
<span class="line"><span>        InputStream inputStream = multipartFile.getInputStream();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // 避免文件覆盖</span></span>
<span class="line"><span>        String originalFilename = multipartFile.getOriginalFilename();</span></span>
<span class="line"><span>        String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //上传文件到 OSS</span></span>
<span class="line"><span>        OSS ossClient = new OSSClientBuilder().build(aliOSSProperties.getEndpoint(),</span></span>
<span class="line"><span>                aliOSSProperties.getAccessKeyId(), aliOSSProperties.getAccessKeySecret());</span></span>
<span class="line"><span>        ossClient.putObject(aliOSSProperties.getBucketName(), fileName, inputStream);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //文件访问路径</span></span>
<span class="line"><span>        String url =aliOSSProperties.getEndpoint().split(&quot;//&quot;)[0] + &quot;//&quot; + aliOSSProperties.getBucketName() + &quot;.&quot; + aliOSSProperties.getEndpoint().split(&quot;//&quot;)[1] + &quot;/&quot; + fileName;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // 关闭ossClient</span></span>
<span class="line"><span>        ossClient.shutdown();</span></span>
<span class="line"><span>        return url;// 把上传到oss的路径返回</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>在我们添加上注解后，会发现idea窗口上面出现一个红色警告：不影响开发，了解一下</p><p>点击查看代码</p><p><img src="`+as+`" alt="image-20230103212042823"></p><p>这个警告提示是告知我们还需要引入一个依赖：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><p>当我们在pom.xml文件当中配置了这项依赖之后，我们重新启动服务，大家就会看到在properties或者是yml配置文件当中，就会提示阿里云 OSS 相关的配置项。所以这项依赖它的作用就是会自动的识别被<code>@Configuration Properties</code>注解标识的bean对象。</p><blockquote><p>刚才的红色警告，已经变成了一个灰色的提示，提示我们需要重新运行springboot服务</p></blockquote><p>@ConfigurationProperties和@Value的区别</p><ul><li><strong>相同点</strong>：都是用来注入外部配置的属性的。</li><li><strong>不同点</strong>： <ul><li>@Value注解只能一个一个的进行外部属性的注入。</li><li>@ConfigurationProperties可以批量的将外部的属性配置注入到bean对象的属性中。</li></ul></li></ul><p>如果要注入的属性非常的多，并且还想做到复用，就可以定义这么一个bean对象 👍👍👍。通过 configuration properties 批量的将外部的属性配置直接注入到 bin 对象的属性当中。在其他的类当中，我要想获取到注入进来的属性，我直接注入 bin 对象，然后调用 get 方法，就可以获取到对应的属性值了</p><h3 id="_4️⃣4-4-三种配置文件的优先级-原理-了解一下" tabindex="-1">4️⃣4.4 三种配置文件的优先级 原理，了解一下 <a class="header-anchor" href="#_4️⃣4-4-三种配置文件的优先级-原理-了解一下" aria-label="Permalink to &quot;4️⃣4.4 三种配置文件的优先级 原理，了解一下&quot;">​</a></h3><p>三种配置文件的优先级</p><p>在SpringBoot项目当中，常见的属性配置方式<strong>有5种(3配+2外)---优先级(从低到高)</strong>：</p><ul><li><p>application.yaml（忽略）</p></li><li><p>application.yml 企业实用</p></li><li><p>application.properties</p></li><li><p>java系统属性（-Dxxx=xxx）</p></li><li><p>命令行参数（--xxx=xxx）测试人员实用</p></li><li><p>application.properties</p></li><li><p>application.yml</p></li><li><p>application.yaml</p></li></ul><p>我们启动SpringBoot程序，测试下三个配置文件中哪个Tomcat端口号生效：</p><ul><li>properties、yaml、yml三种配置文件同时存在</li></ul><p><img src="`+ns+'" alt="image-20230113144757856"></p><blockquote><p>properties、yaml、yml三种配置文件，优先级最高的是properties</p></blockquote><ul><li>yaml、yml两种配置文件同时存在</li></ul><p><img src="'+ps+'" alt="image-20230113145158771"></p><p>在SpringBoot项目当中除了以上3种配置文件外，SpringBoot为了增强程序的扩展性，除了支持配置文件的配置方式以外，还支持另外两种常见的配置方式🚀 🚀：</p><ol><li>Java系统属性配置 （格式： -Dkey=value）</li><li>命令行参数 （格式：--key=value） 测试人员实用</li></ol><p>**思考：如果项目已经打包上线了，这个时候我们又如何来设置Java系统属性和命令行参数呢？**测试人员实用</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>java -Dserver.port=9000 -jar XXXXX.jar --server.port=10010</span></span></code></pre></div><p>下面我们来演示下打包程序运行时指定Java系统属性和命令行参数：</p><ol><li>执行maven打包指令package，把项目打成jar文件</li><li>使用命令：java -jar 方式运行jar文件程序</li></ol><p>项目打包：</p><p><img src="'+ts+'" alt="image-20230113172313655"></p><p><img src="'+es+'" alt="image-20230113172854016"></p><p>运行jar程序：</p><ul><li>同时设置Java系统属性和命令行参数</li></ul><p><img src="'+ls+'" alt="image-20230113172659269"></p><ul><li>仅设置Java系统属性</li></ul><p><img src="'+is+'" alt="image-20230113173228232"></p><blockquote><p>注意事项：</p><ul><li>Springboot项目进行打包时，需要引入插件 spring-boot-maven-plugin (基于官网骨架创建项目，会自动添加该插件)</li></ul></blockquote><p>点击查看idea当中运行程序时，如何来指定Java系统属性和命令行参数</p><p>**那在idea当中运行程序时，如何来指定Java系统属性和命令行参数呢？**了解一下</p><ul><li>编辑启动程序的配置信息</li></ul><p><img src="'+os+'" alt="image-20230113162746634"></p><p><img src="'+cs+'" alt="image-20230113162639630"></p><p>重启服务，同时配置Tomcat端口(三种配置文件、系统属性、命令行参数)，测试哪个Tomcat端口号生效：</p><p><img src="'+rs+'" alt="image-20230113165006550"></p><p>删除命令行参数配置，重启SpringBoot服务：</p><p><img src="'+ds+`" alt="image-20230113170841253"></p><blockquote><p>优先级： 命令行参数 &gt; 系统属性参数 &gt; properties参数 &gt; yml参数 &gt; yaml参数</p></blockquote><h3 id="_5️⃣4-5-bean管理-原理-了解一下-🍐" tabindex="-1">5️⃣4.5 Bean管理 原理，了解一下 🍐 <a class="header-anchor" href="#_5️⃣4-5-bean管理-原理-了解一下-🍐" aria-label="Permalink to &quot;5️⃣4.5 Bean管理 原理，了解一下 🍐&quot;">​</a></h3><p>目标</p><p>主要学习IOC容器中Bean的其他使用细节，主要学习以下三方面：</p><ol><li>如何从<strong>IOC容器</strong>中手动的获取到bean对象</li><li>bean的<strong>作用域</strong>配置</li><li>管理<strong>第三方的bean</strong>对象</li></ol><p>已经学过的Spring注解</p><ul><li>控制反转(IOC) <ul><li>@Component <ul><li>@Controller</li><li>@Service</li><li>@Repository</li></ul></li></ul></li><li>依赖注入(DI) <ul><li>@Autowired</li></ul></li></ul><p><strong>代码演示</strong> 👇 👇</p><p>相关信息</p><ol><li>想获取到IOC容器，直接将IOC容器对象ApplicationContext注入进来,</li><li>而在Spring容器中提供了一些方法，可以主动从IOC容器（ApplicationContext）中获取到bean对象，</li><li>下面介绍3种常用方式： <ul><li>根据name获取bean --<code>Object getBean(String name)</code></li><li>根据类型获取bean --<code>&lt;T&gt; T getBean(Class&lt;T&gt; requiredType)</code></li><li>根据name获取bean（带类型转换）--<code>&lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType)</code></li></ul></li></ol><p>测试类：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@SpringBootTest</span></span>
<span class="line"><span>class SpringbootWebConfig2ApplicationTests {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private ApplicationContext applicationContext; //IOC容器对象</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //获取bean对象</span></span>
<span class="line"><span>    @Test</span></span>
<span class="line"><span>    public void testGetBean(){</span></span>
<span class="line"><span>        //根据bean的名称获取</span></span>
<span class="line"><span>        DeptController bean1 = (DeptController) applicationContext.getBean(&quot;deptController&quot;);</span></span>
<span class="line"><span>        System.out.println(bean1);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //根据bean的类型获取</span></span>
<span class="line"><span>        DeptController bean2 = applicationContext.getBean(DeptController.class);</span></span>
<span class="line"><span>        System.out.println(bean2);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //根据bean的名称 及 类型获取</span></span>
<span class="line"><span>        DeptController bean3 = applicationContext.getBean(&quot;deptController&quot;, DeptController.class);</span></span>
<span class="line"><span>        System.out.println(bean3);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>程序运行后控制台日志：</p><p><img src="`+us+'" alt="image-20230113211619818"></p><blockquote><p>问题：输出的bean对象地址值是一样的，说明IOC容器当中的bean对象有几个？</p><p>答案：只有一个。 （默认情况下，IOC中的bean对象是单例）</p><p>那么能不能将bean对象设置为非单例的(每次获取的bean都是一个新对象)？</p><p>可以，在下一个知识点(bean作用域)中讲解。</p></blockquote><p>注意事项：</p><ul><li>上述所说的 【Spring项目启动时，会把其中的bean都创建好】还会受到作用域及延迟初始化影响，这里主要针对于默认的单例非延迟加载的bean而言。</li></ul><p>在前面我们提到的IOC容器当中，默认bean对象是<strong>单例模式(只有一个实例对象)</strong>。那么如何设置bean对象为非单例呢？需要设置bean的作用域。</p><p><strong>在Spring中支持五种作用域，后三种在web环境才生效：</strong></p><table><thead><tr><th><strong>作用域</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>singleton默认</td><td>容器内同名称的bean只有一个实例（单例）（默认）</td></tr><tr><td>prototype 多例</td><td>每次使用该bean时会创建新的实例（非单例）</td></tr><tr><td>requestweb环境中，了解</td><td>每个请求范围内会创建新的实例</td></tr><tr><td>sessionweb环境中，了解</td><td>每个会话范围内会创建新的实例</td></tr><tr><td>applicationweb环境中，了解</td><td>每个应用范围内会创建新的实例</td></tr></tbody></table><p><strong>设置作用域的步鄹：</strong> 👇 👇</p><ul><li>可以借助Spring中的@Scope注解来进行配置作用域</li></ul><p><img src="'+gs+`" alt="image-20230113214244144"></p><p><strong>1). 测试一</strong></p><p>点击查看设置单例 和懒加载 步鄹</p><ul><li>控制器</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>//默认bean的作用域为：singleton (单例)</span></span>
<span class="line"><span>@Lazy //延迟加载（第一次使用bean对象时，才会创建bean对象并交给ioc容器管理）</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>@RequestMapping(&quot;/depts&quot;)</span></span>
<span class="line"><span>public class DeptController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private DeptService deptService;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public DeptController(){</span></span>
<span class="line"><span>        System.out.println(&quot;DeptController constructor ....&quot;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略其他代码...</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>测试类</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@SpringBootTest</span></span>
<span class="line"><span>class SpringbootWebConfig2ApplicationTests {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private ApplicationContext applicationContext; //IOC容器对象</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //bean的作用域</span></span>
<span class="line"><span>    @Test</span></span>
<span class="line"><span>    public void testScope(){</span></span>
<span class="line"><span>        for (int i = 0; i &lt; 10; i++) {</span></span>
<span class="line"><span>            DeptController deptController = applicationContext.getBean(DeptController.class);</span></span>
<span class="line"><span>            System.out.println(deptController);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>重启SpringBoot服务，运行测试方法，查看控制台打印的日志：</p><p><img src="`+ms+`" alt="image-20230114001348839"></p><blockquote><p>注意事项：</p><ul><li><p>IOC容器中的bean默认使用的作用域：singleton (单例)</p></li><li><p>默认singleton的bean，在容器启动时被创建，可以使用@Lazy注解来延迟初始化(延迟到第一次使用时)</p></li></ul></blockquote><p><strong>2). 测试二</strong></p><p>点击查看非单例 实现</p><p>修改控制器DeptController代码：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Scope(&quot;prototype&quot;) //bean作用域为非单例</span></span>
<span class="line"><span>@Lazy //延迟加载</span></span>
<span class="line"><span>@RestController</span></span>
<span class="line"><span>@RequestMapping(&quot;/depts&quot;)</span></span>
<span class="line"><span>public class DeptController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    private DeptService deptService;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public DeptController(){</span></span>
<span class="line"><span>        System.out.println(&quot;DeptController constructor ....&quot;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //省略其他代码...</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>重启SpringBoot服务，再次执行测试方法，查看控制吧打印的日志：</p><p><img src="`+hs+`" alt="image-20230114001736151"></p><p>技巧</p><ul><li>prototype的bean，每一次使用该bean的时候都会创建一个新的实例</li><li>实际开发当中，<strong>绝大部分的Bean是单例的</strong>单身dog，也就是说绝大部分Bean不需要配置scope属性</li></ul><ol><li>Jar包中的类(不能在类名上加注解)，怎样将这些类的对象交给IOC管理尼？</li></ol><p>点击查看答案</p><p>我们所配置的bean，像controller、service，dao三层体系下编写的类，这些类都是我们在项目当中<strong>自己定义的类(自定义类)</strong>。当我们要声明这些bean，也非常简单，我们只需要在类上加上@Component以及它的这三个衍生<strong>注解</strong>（@Controller、@Service、@Repository），就可以来声明这个bean对象了。</p><p>如果要管理的bean对象来自于第三方（不是自定义的,如jar包中的类），是无法用@Component 及衍生注解声明bean的，就需要用到 <strong>@Bean</strong> 注解。</p><p><strong>测试程序</strong> 👇 👇</p><p>点击查看测试程序代码</p><p>第一步：在pom.xml文件中，引入dom4j：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>&lt;!--Dom4j--&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.dom4j&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;dom4j&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;2.1.3&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><blockquote><p>dom4j就是第三方组织提供的。 dom4j中的SAXReader类就是第三方编写的。</p></blockquote><p>思考：当我们需要使用到SAXReader对象时，直接进行依赖注入是不是就可以了呢？</p><ul><li>按照我们之前的做法，需要在SAXReader类上添加一个注解@Component（将当前类交给IOC容器管理）</li></ul><p><img src="`+bs+`" alt="image-20230114003903285"></p><blockquote><p>结论：第三方提供的类是只读的 。无法在第三方类上添加@Component注解或衍生注解。</p></blockquote><p><strong>解决方案1：在配置类中定义@Bean标识的方法</strong> 企业实用</p><ul><li>如果需要定义第三方Bean时， 通常会单独定义一个配置类</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>@Configuration //配置类  (在配置类当中对第三方bean进行集中的配置管理)</span></span>
<span class="line"><span>public class CommonConfig {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //声明第三方bean</span></span>
<span class="line"><span>    @Bean //将当前方法的返回值对象交给IOC容器管理, 成为IOC容器bean</span></span>
<span class="line"><span>          //通过@Bean注解的name/value属性指定bean名称, 如果未指定, 默认是方法名</span></span>
<span class="line"><span>    public SAXReader reader(DeptService deptService){</span></span>
<span class="line"><span>        System.out.println(deptService);</span></span>
<span class="line"><span>        return new SAXReader();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><p>注释掉SpringBoot启动类中创建第三方bean对象的代码，重启服务，执行测试方法，查看控制台日志：</p><p>在方法上加上一个@Bean注解，Spring 容器在启动的时候，它会自动的调用这个方法，并将方法的返回值声明为Spring容器当中的Bean对象。</p><p>技巧</p><p>注意事项 ：</p><ul><li>通过 <strong>@Bean</strong> 注解的name或value属性可以声明bean的名称，如果不指定，<strong>默认bean的名称就是方法名</strong>。</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>    //@Bean 默认名字 saxReader</span></span>
<span class="line"><span>    //@Bean(&quot;sax&quot;) 指定名字 sax</span></span>
<span class="line"><span>    public SAXReader saxReader(){</span></span>
<span class="line"><span>        return new SAXReader();</span></span>
<span class="line"><span>    }</span></span></code></pre></div><ul><li>如果第三方bean需要依赖其它bean对象，直接在bean定义方法中设置形参即可，容器会根据类型自动装配。</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light dracula-soft vp-code"><code><span class="line"><span>    @Bean 默认名字 saxReader</span></span>
<span class="line"><span>    public SAXReader saxReader(Brand brand){ //如果容器中有Brand对象，会自动装配</span></span>
<span class="line"><span>        return new SAXReader();</span></span>
<span class="line"><span>    }</span></span></code></pre></div><p>关于Bean大家只需要保持一个原则：</p><ul><li><p>如果是在项目当中我们自己定义的类，想将这些类交给IOC容器管理，我们直接使用 <strong>@Component</strong> 以及它的衍生注解来声明就可以。</p></li><li><p>如果这个类它不是我们自己定义的，而是引入的第三方依赖当中提供的类，而且我们还想将这个类交给IOC容器管理。此时我们就需要在配置类中定义一个方法，在方法上加上一个 <strong>@Bean</strong> 注解，<strong>通过这种方式来声明第三方的bean对象。</strong></p></li></ul>`,386),Ss=[vs];function ys(Cs,ks,_s,fs,Is,Os){return t(),p("div",null,Ss)}const xs=n(qs,[["render",ys]]);export{Bs as __pageData,xs as default};
